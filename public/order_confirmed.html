<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Compra confirmada ‚Äî Petfinder</title>
  <link rel="stylesheet" href="/assets/css/landing.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner" style="max-width:720px;">
      <a class="brand" href="/">
        <span class="brand-mark">üêæ</span>
        <span class="brand-name">Petfinder</span>
      </a>
  <nav class="main-nav"><a href="/shop">Tienda</a><a href="/cart" id="cartLink" style="position:relative;">Carrito <span id="cartCount" style="position:absolute;top:-6px;right:-10px;background:#ef4444;color:#fff;border-radius:999px;padding:0 6px;font-size:12px;line-height:18px;min-width:18px;text-align:center;display:none;">0</span></a><a href="/blog">Blog</a><a id="hdrLogin" href="/login">Ingresar</a><span id="hdrName" style="margin-left:8px;opacity:.9;"></span></nav>
    </div>
  </header>
  <main class="section">
    <div class="container" style="max-width:720px;">
      <h1>¬°Compra confirmada!</h1>
      <div id="orderInfo" class="demo-help" style="font-size:1.1em;margin:24px 0;"></div>
      <a href="/shop" class="button button-primary">Volver a la tienda</a>
    </div>
  </main>
  <footer class="site-footer">
    <div class="container footer-inner" style="max-width:720px;">
      <div class="footer-credit">Creado por Mike Rodr√≠guez</div>
      <nav class="footer-nav" aria-label="Footer">
        <a href="https://github.com/mikerb95" target="_blank" rel="noopener">GitHub</a>
        <a href="/terms">T√©rminos</a>
        <a href="/privacy">Privacidad</a>
        <a href="/license">Licencia</a>
      </nav>
    </div>
  </footer>
  <script src="/assets/js/header-user.js" defer></script>
  <script>
    (async function(){
      try{
        const r = await fetch('/api/cart', {credentials:'include'});
        const d = await r.json().catch(()=>({}));
        const n = (d.items||[]).reduce((a,it)=>a+Number(it.quantity||0),0);
        const el = document.getElementById('cartCount');
        if (el) { if (n>0){ el.textContent=String(n); el.style.display='inline-block'; } else el.style.display='none'; }
      }catch(_){ }
    })();
    async function loadOrder() {
      const url = new URL(window.location.href);
      const orderId = url.searchParams.get('order');
      if (!orderId) { document.getElementById('orderInfo').textContent = 'No se encontr√≥ la orden.'; return; }
      const res = await fetch('/api/payment/' + orderId);
      const data = await res.json();
      if (!data.order) { document.getElementById('orderInfo').textContent = 'Orden no encontrada.'; return; }
      const o = data.order;
      document.getElementById('orderInfo').innerHTML = `
        <div>¬°Gracias por tu compra, ${o.name}!</div>
        <div>N√∫mero de orden: <strong>${o.order_number}</strong> ‚Äî <a href="/order_lookup">Consultar pedido</a></div>
        <div>Recibir√°s confirmaci√≥n al correo: <strong>${o.email}</strong></div>
        <div>Enviaremos tu pedido a: <strong>${o.address}, ${o.city}</strong></div>
  <div>Total pagado: <strong>${new Intl.NumberFormat('es-CO',{style:'currency',currency:o.currency||'COP'}).format(o.total_cents/100)}</strong></div>
        <div style='margin-top:12px;'>¬øDudas? <a href='/contact'>Cont√°ctanos</a></div>
      `;
    }
    loadOrder();
  </script>
  <script>
    // Mostrar nombre en el header si hay sesi√≥n iniciada
    (async function(){
      try {
        const t = localStorage.getItem('auth_token');
        if (!t) return;
        const res = await fetch('/api/me', { headers: { 'Authorization': 'Bearer ' + t } });
        if (!res.ok) return;
        const data = await res.json().catch(()=>({}));
        const name = data && data.user && data.user.name;
        if (name) {
          const el = document.getElementById('hdrName');
          if (el) el.textContent = 'Hola, ' + name;
          const login = document.getElementById('loginLink');
          if (login) login.style.display = 'none';
        }
      } catch(_){ }
    })();
  </script>
</body>
</html>
