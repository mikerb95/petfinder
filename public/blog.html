<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blog - Petfinder</title>
  <link rel="stylesheet" href="/assets/css/landing.css" />
  <style>
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0}
    .toolbar .input{min-width:240px}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="/"><span class="brand-mark">ğŸ¾</span><span class="brand-name">Petfinder</span></a>
      <nav class="main-nav"><a href="/shop">Tienda</a><a href="/blog">Blog</a><a href="/dashboard">Dashboard</a></nav>
    </div>
  </header>

  <main class="section">
    <div class="container" style="max-width:980px;">
      <h1>Blog</h1>
      <div class="toolbar">
        <input id="q" class="input" placeholder="Buscar..." />
        <select id="status" class="input" style="max-width:220px">
          <option value="published">Publicados</option>
          <option value="draft">Borradores</option>
          <option value="archived">Archivados</option>
        </select>
        <a class="button button-primary" href="/blog/editor">Nuevo post</a>
      </div>
      <div id="list" class="cards"></div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div class="footer-credit">Creado por Mike RodrÃ­guez</div>
      <nav class="footer-nav" aria-label="Footer">
        <a href="https://github.com/mikerb95" target="_blank" rel="noopener">GitHub</a>
        <a href="/terms">TÃ©rminos</a>
        <a href="/privacy">Privacidad</a>
        <a href="/license">Licencia</a>
      </nav>
    </div>
  </footer>
  <script>
    async function load() {
      const q = document.getElementById('q').value.trim();
      const status = document.getElementById('status').value;
      const url = new URL('/api/blog/posts', location.origin);
      if (q) url.searchParams.set('q', q);
      if (status) url.searchParams.set('status', status);
      const r = await fetch(url);
      const data = await r.json();
      const el = document.getElementById('list');
      el.innerHTML = '';
      const posts = data.posts||[];
      if (!posts.length) {
        const empty = document.createElement('div');
        empty.className = 'card';
        empty.innerHTML = '<div class="muted">No hay publicaciones para este filtro.</div>';
        el.appendChild(empty);
      }
      posts.forEach(p => {
        const d = document.createElement('div');
        d.className = 'card';
        const chips = [...(p.categories||[]).map(c=>`<span class="chip">ğŸ·ï¸ ${c}</span>`), ...(p.tags||[]).map(t=>`<span class=\"chip\">#${t}</span>`)].join(' ');
        d.innerHTML = `
          ${p.cover_image_url ? `<div class="card-cover"><img src="${p.cover_image_url}" alt="${p.title}" loading="lazy" /></div>` : ''}
          <h3 style="margin:0 0 6px"><a href="/blog/${p.slug}">${p.title}</a></h3>
          ${chips ? `<div class="chips">${chips}</div>` : ''}
          <p class="muted" style="margin:0 0 8px">${(p.excerpt||'').slice(0,180)}</p>
          <div class="muted" style="font-size:.9rem">por ${p.author_name||'AnÃ³nimo'} Â· ${(p.published_at||'').replace('T',' ').slice(0,16)}</div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <span class="badge">ğŸ‘ ${p.up_count||0}</span>
            <span class="badge">ğŸ‘ ${p.down_count||0}</span>
            <span class="badge">ğŸ’¬ ${p.comment_count||0}</span>
          </div>
        `;
        el.appendChild(d);
      });
    }
    document.getElementById('q').addEventListener('input', () => setTimeout(load, 200));
    document.getElementById('status').addEventListener('change', load);
    load();
  </script>
</body>
</html>
