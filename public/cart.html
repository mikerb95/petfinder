<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carrito ‚Äî Petfinder</title>
  <link rel="stylesheet" href="/assets/css/landing.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner" style="max-width:720px;">
      <a class="brand" href="/">
        <span class="brand-mark">üêæ</span>
        <span class="brand-name">Petfinder</span>
      </a>
      <nav class="main-nav"><a href="/shop">Tienda</a><a href="/cart">Carrito</a><a href="/blog">Blog</a></nav>
    </div>
  </header>
  <main class="section">
    <div class="container" style="max-width:720px;">
      <h1>Carrito de compras</h1>
      <div id="cartItems"></div>
      <div id="cartTotal" style="font-size:1.2em;margin:16px 0;"></div>
      <a href="/checkout" class="button button-primary">Ir al checkout</a>
    </div>
  </main>
  <footer class="site-footer">
    <div class="container footer-inner" style="max-width:720px;">
      <div class="footer-credit">Creado por Mike Rodr√≠guez</div>
      <nav class="footer-nav" aria-label="Footer">
        <a href="https://github.com/mikerb95" target="_blank" rel="noopener">GitHub</a>
        <a href="/terms">T√©rminos</a>
        <a href="/privacy">Privacidad</a>
        <a href="/license">Licencia</a>
      </nav>
    </div>
  </footer>
  <script>
    async function loadCart() {
      const res = await fetch('/api/cart');
      const data = await res.json();
      const items = data.items || [];
      const el = document.getElementById('cartItems');
      el.innerHTML = '';
      if (!items.length) { el.innerHTML = '<div class="demo-help">Tu carrito est√° vac√≠o.</div>'; document.getElementById('cartTotal').textContent = ''; return; }
  let total = 0;
      items.forEach(item => {
        total += item.price_cents * item.quantity;
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <img src="${item.image_url}" alt="${item.name}" class="card-cover" style="max-height:80px;object-fit:cover;" />
          <div class="card-body">
            <h2 class="card-title">${item.name}</h2>
            <div>Cantidad: <input type="number" min="1" max="${item.stock}" value="${item.quantity}" style="width:60px;" data-id="${item.product_id}" /></div>
    <div>Precio unitario: ${new Intl.NumberFormat('es-CO',{style:'currency',currency:item.currency||'COP'}).format(item.price_cents/100)}</div>
    <div>Subtotal: ${new Intl.NumberFormat('es-CO',{style:'currency',currency:item.currency||'COP'}).format((item.price_cents*item.quantity)/100)}</div>
            <button class="button" data-remove="${item.product_id}">Eliminar</button>
          </div>
        `;
        el.appendChild(div);
      });
  document.getElementById('cartTotal').textContent = 'Total: ' + new Intl.NumberFormat('es-CO',{style:'currency',currency:'COP'}).format(total/100);
      // Actualizar cantidad
      el.querySelectorAll('input[type=number]').forEach(inp => {
        inp.onchange = async function() {
          const pid = inp.getAttribute('data-id');
          const qty = Math.max(1, Math.min(Number(inp.value), 99));
          await fetch('/api/cart', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ product_id: pid, quantity: qty })
          });
          loadCart();
        };
      });
      // Eliminar
      el.querySelectorAll('button[data-remove]').forEach(btn => {
        btn.onclick = async function() {
          const pid = btn.getAttribute('data-remove');
          await fetch('/api/cart', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ product_id: pid })
          });
          loadCart();
        };
      });
    }
    loadCart();
  </script>
</body>
</html>
