<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mascota encontrada ‚Äî Petfinder</title>
    <link rel="stylesheet" href="/assets/css/landing.css" />
    <style>
      .pet-card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
      .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:.85rem}
      .badge-home{background:#eaf7ea;color:#157e36}
      .badge-lost{background:#ffefef;color:#b30000}
      .grid{display:grid;gap:16px}
      @media(min-width:720px){.grid{grid-template-columns:1.2fr .8fr}}
      .pet-photo{width:100%;max-height:360px;object-fit:cover;border-radius:10px;background:#f6f6f6}
      .meta{color:#444}
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="/">
          <span class="brand-mark">üêæ</span>
          <span class="brand-name">Petfinder</span>
        </a>
      </div>
    </header>

    <main class="section">
      <div class="container" style="max-width:960px;">
        <h1 id="title">Mascota encontrada</h1>
        <p>Gracias por escanear el c√≥digo. Usa estos datos para contactar a su propietario.</p>

        <div id="content" class="grid">
          <div class="pet-card">
            <img id="photo" class="pet-photo" alt="Mascota" />
            <h2 id="petName"></h2>
            <p class="meta" id="petMeta"></p>
            <p class="meta" id="petNotes"></p>
            <span id="status" class="badge"></span>
          </div>
          <div class="pet-card">
            <h3>Contacto del propietario</h3>
            <p><strong>Nombre:</strong> <span id="ownerName"></span></p>
            <p><strong>Tel√©fono:</strong> <a id="ownerPhone"></a></p>
            <p><strong>Correo:</strong> <a id="ownerEmail"></a></p>
            <p><a class="button" href="/">Volver al inicio</a></p>
          </div>
        </div>

        <div id="notFound" class="feature-item" style="display:none;">
          <h3>No encontrado</h3>
          <p>El c√≥digo no corresponde a ninguna mascota. Verifica el QR o contacta al propietario.</p>
          <p><a class="button" href="/">Volver</a></p>
        </div>
      </div>
    </main>

    <script>
      (function(){
        const parts = window.location.pathname.split('/');
        const qrId = parts[2] || '';
        const content = document.getElementById('content');
        const notFound = document.getElementById('notFound');
        fetch('/api/pets/public/' + encodeURIComponent(qrId))
          .then(async r => {
            if (!r.ok) throw new Error('not found');
            return r.json();
          })
          .then(d => {
            const pet = d.pet || {}; const owner = d.owner || {};
            document.getElementById('petName').textContent = pet.name || 'Mascota';
            const parts = [];
            if (pet.species) parts.push('Especie: ' + pet.species);
            if (pet.breed) parts.push('Raza: ' + pet.breed);
            if (pet.color) parts.push('Color: ' + pet.color);
            document.getElementById('petMeta').textContent = parts.join(' | ');
            document.getElementById('petNotes').textContent = pet.notes ? ('Notas: ' + pet.notes) : '';
            const status = document.getElementById('status');
            if (pet.status === 'lost') { status.textContent = 'Perdida'; status.className = 'badge badge-lost'; }
            else { status.textContent = 'En casa'; status.className = 'badge badge-home'; }
            const photo = document.getElementById('photo');
            if (pet.photo_url) { photo.src = pet.photo_url; photo.style.display='block'; }
            else { photo.style.display='none'; }
            document.getElementById('ownerName').textContent = owner.name || '';
            const phoneA = document.getElementById('ownerPhone');
            phoneA.textContent = owner.phone || 'No disponible';
            phoneA.href = owner.phone ? ('tel:' + owner.phone) : '#';
            const emailA = document.getElementById('ownerEmail');
            emailA.textContent = owner.email || 'No disponible';
            emailA.href = owner.email ? ('mailto:' + owner.email) : '#';
          })
          .catch(() => { content.style.display = 'none'; notFound.style.display = 'block'; });
      })();
    </script>
  </body>
</html>
